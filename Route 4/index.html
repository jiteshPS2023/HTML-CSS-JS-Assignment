<!DOCTYPE html>
<html>

<head>
    <title>Route 4 - Student marks table</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="default.css">
</head>

<body>
    <div class="container" style="margin-top: 10%;">
        <div class="row">
            <div id="divTbl" class="col-md-12">
            </div>
        </div>
    </div>
    <input id="sortType" type="hidden" value="1" />
    <input id="sortCol" type="hidden" value="" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

    <script type="text/javascript">
        
        $(document).ready(function () {
            showTableData('');
        });
        function GetSampleJson(){
            let stdJson = [
                {
                    "Name": "Jitesh",
                    "Class": 9,
                    "Section": "A",
                    "Sub1": 70,
                    "Sub2": 75,
                    "Sub3": 80
                },
                {
                    "Name": "Tanuja",
                    "Class": 12,
                    "Section": "D",
                    "Sub1": 80,
                    "Sub2": 85,
                    "Sub3": 95
                },
                {
                    "Name": "Shri",
                    "Class": 11,
                    "Section": "C",
                    "Sub1": 77,
                    "Sub2": 82,
                    "Sub3": 87
                },
                {
                    "Name": "Spadigha",
                    "Class": 10,
                    "Section": "B",
                    "Sub1": 75,
                    "Sub2": 80,
                    "Sub3": 85
                }
            ]
            return stdJson;
        }
        function showTableData(sortCol) {
            let stdMarks = GetSampleJson();
            
            stdMarks = sortData(stdMarks, sortCol);
            let col = [];
            for (let i = 0; i < stdMarks.length; i++) {
                for (let key in stdMarks[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }

            const table = document.createElement("table");
            table.classList.add("table");
            table.classList.add("table-dark");
            table.classList.add("table-striped");
            let tr = table.insertRow(-1);                 

            for (let i = 0; i < col.length; i++) {
                let th = document.createElement("th");
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

            for (let i = 0; i < stdMarks.length; i++) {

                tr = table.insertRow(-1);

                for (let j = 0; j < col.length; j++) {
                    let tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = stdMarks[i][col[j]];
                }
            }

            const divShowData = document.getElementById('divTbl');
            divShowData.innerHTML = "";
            divShowData.appendChild(table);
            AddOnClickEvent();
        }
        
        function sortData(stdMarks, sortCol){
            //Get sort type
            let sortType = parseInt($('#sortType').val());
            if(sortCol == '')
            {
               return stdMarks; 
            } if(sortCol=='Name')
            {
                if(sortType==1)
                {
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Name < b.Name) {
                            return -1;
                        }
                    });
                }else if(sortType==2){
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Name > b.Name) {
                            return -1;
                        }
                    });
                }
                else
                    stdMarks = GetSampleJson();
            }else if(sortCol=='Section')
            {
                if(sortType==1)
                {
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Section < b.Section) {
                            return -1;
                        }
                    });
                }else if(sortType==2){
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Section > b.Section) {
                            return -1;
                        }
                    });
                }
                else
                    stdMarks = GetSampleJson();
            }else if(sortCol=='Class')
            {
                if(sortType==1)
                {
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Class < b.Class) {
                            return -1;
                        }
                    });
                }else if(sortType==2){
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Class > b.Class) {
                            return -1;
                        }
                    });
                }
                else
                    stdMarks = GetSampleJson();
            }else if(sortCol=='Sub1')
            {
                if(sortType==1)
                {
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Sub1 < b.Sub1) {
                            return -1;
                        }
                    });
                }else if(sortType==2){
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Sub1 > b.Sub1) {
                            return -1;
                        }
                    });
                }
                else
                    stdMarks = GetSampleJson();
            }else if(sortCol=='Sub2')
            {
                if(sortType==1)
                {
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Sub2 < b.Sub2) {
                            return -1;
                        }
                    });
                }else if(sortType==2){
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Sub2 > b.Sub2) {
                            return -1;
                        }
                    });
                }
                else
                    stdMarks = GetSampleJson();
            }else if(sortCol=='Sub3')
            {
                if(sortType==1)
                {
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Sub3 < b.Sub3) {
                            return -1;
                        }
                    });
                }else if(sortType==2){
                    stdMarks = stdMarks.sort((a, b) => {
                        if (a.Sub3 > b.Sub3) {
                            return -1;
                        }
                    });
                }
                else
                    stdMarks = GetSampleJson();
            }
            return stdMarks;
        }
        function compareStrings(a, b) {
            a = a.toLowerCase();
            b = b.toLowerCase();
            
            //Get sort type
            let sortType = parseInt($('#sortType').val());
            if(sortType==1)
            {
                return a-b;
            }else if(sortType==2)
            {
                return b-a;
            }else  return 1;
        }


        function AddOnClickEvent(){
            $('tr th').each(function(){
                $(this).click(function(){
                    let sortType = parseInt($('#sortType').val());
                    let oldSortCol = $('#sortCol').val();
                    let newSortCol = $(this).text();

                    if(oldSortCol!=newSortCol)
                    {
                        sortType=1;
                        $('#sortType').val(sortType);
                    }

                    showTableData(newSortCol);
                    sortType+=1;

                    if(sortType>3)
                        sortType=1;

                    $('#sortType').val(sortType);
                    $('#sortCol').val(newSortCol);
                });
            });
        }

    </script>
</body>

</html>